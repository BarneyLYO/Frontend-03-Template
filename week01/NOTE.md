# Week 1 Note

## 编程语言

### 语言分类

所有语言都可分为*形式语言*与*非形式语言*
_非形式语言_： 自然语言
_形式语言_： 计算机语言， 用精确的数学或机器可以处理的公式的语言。形式语言一般分为两个方面，_语法_，_语义_。

#### 语法

语法是形式语言中字符串一套产生式规则，描述了如何用语言的字母表产出符合语法的有效字符串。

##### BNF

表现形式
`<expr> ::= <term>|<expr><addop><term>`
规则如下：

- 用尖括号括起来的名称来表示语法结构名
- 语法结构分成基础结构和需要用其他语法结构定义的复合结构
  - 基础结构称为终结符
  - 复合结构称为「非终结符」
- 引号和中间的字符表示终结符
- 可以有括号
- \* 表示重复多次
- | 表示 或
- \+ 表示至少一次

支持四则运算的 BNF 例子

```
  <Number> ::= "0"|"1"|...|"9"

  <MultiplicationExpression> ::= <Expression> | <MultiplicationExpression> "*" <Expression> |
  <MultiplicationExpression> "/" <Expression>

  <AdditionExpression> ::= <MultiplicationExpression> |
  <AdditionExpression> "+" <MultiplicationExpression> |
  <AdditionExpression> "-" <MultiplicationExpression>

  <LogicalExpression> ::= <AdditionExpression> | <LogicalExpression> "||" <AdditionExpression> |
  <LogicalExpression> "&&" <AdditionExpression>

  <Expression> ::= <Number> | "("<LogicalExpression>")"
```

### 命令式编程语言

命令式编程语言由 5 层结构组成

- Atom
  在编程语言中最细粒度的元素
  - Identifier 标识符 变量名
  - Literal 直接量
- Expression
  表达式： Atom 加上 Opeator(运算符)或者 Punctual(符号)组成
- Statement
  陈述式： Expression 加上 Keyword（关键字）或 Punctual（符号）
- Structure
  结构式： Collection of Expression / Statement
  - Function
  - Class
  - Process
  - Namespace
  - and bla bla
- Program
  程序
  - Program
  - Module
  - Package
  - Library

## JS

Programming Language = Grammar（文法）\+ Semantics（语义）/\+ Runtime（运行时）

### Grammar

Grammar 由词法(Lexical)与语法(Syntax)组成
ECMA262 定义 Lexical：

- WhiteSpace
- LineTerminator
- Comment
- Token - Identifier - Keyword - Punctuator - NumberLiteral - StringLiteral - RegularExpressionLiteral - Template (Template String Literal)
  Syntax(与 Semantic 一一对应， 一个 Syntax 有一个 Semantic):
- Atom
  - Grammer
    - Literal
    - Variable
    - Keywords
    - Whitespace
    - Line Terminator
  - Runtime
    - Types
    - Execution Context
- Expression
  - Type
    1. Member
       a.b, a\[b\],foo`string`,super.b,new.target,new Foo()
    2. New
       new Foo
    3. Call
       foo(), super()
    4. update ++,--
    5. unary, delete,await...
    6. binary operator
    7. Equality and Bitewise
    8. conditional ? xx:xx
    - LHS & RHS
      - RHS: not lhs:
  - Runtime
    - Type Convertion
      - False Family:
        NaN,0,'',false,null,undefine
      - Object Unbox:
        1. ToPrimitive
        2. toString/valueOf
        3. Symbol.toPrimitive
    - Reference
      {string, key}
- Statement
  - statement
    1. ExpressionStatement
    2. EmptyStatement
    3. DebuggerStatement
    4. ThrowStatement
    5. ContinueStatement
    6. BreakStatement
    7. ReturnStatement
  - composed statement
    1.BlockStatement
    2.IfStatement
    3.SwitchStatement
    4.IterationStatement
    5.WithStatement
    6.LabelledStatement
    7.TryStatement
  - decalration statement
    1.FunctionDeclaration
    2.GeneratorDeclaration
    3.AsyncFunctionDeclaration
    4.AsyncGeneratorDeclaration
    5.VariableStatement
    6.ClassDeclaration
    7.LexicalDeclaration
  - Runtime
    - Completion Record
      - Statement execution result
      - Structure: {
        \[\[type\]\]: normal|break|continue|return|throw,
        \[\[value\]\]:primitive type,
        \[\[target\]\]:label
        }
    - Lexical Enviroment
- Structure

  - Execution Granularity
    - Marco Task
      1. Generated By Host Enviroment and pass to JS Engine
    - Mirco Task (Promise)
      1. Job performed by Engine
    - Function Call (Execution Context)
    - Statement/Declaration (Completion Record)
    - Expression (Reference)
    - Literal/Variable/this

- Program (Script & Module)

#### Atom Type

7 种基本类型

- Undefined
  是一个全局变量，用 void 0 表示
- Null
- Number
  IEEE 754 double, 1 bit sign, 11 sign Exponent, 52 bit Fraction
- String
  - Character 字符
  - Code Pointer
  - Encoding
    - ASCII
    - Unicode
    - UTF
- Boolean
- Symbol
  - unique Identifier
- Object
  - 描述：
    - Identifier: Memory address
    - State
    - Behavior
  - 原型：Nihilo 生原型，原型生对象，对象生万物
  - 运行时： 只关心原型和属性部分 -属性
    - Data Property: Value, Wirtable, Enumerable, Configurable. 属性描述
    - Accessor Property: get, set, enumerable, configurable. 行为描述
  - API
    - {}, [], Object.defineProperty, Object.create, Object.setPrototypeOf,Object.getPrototypeOf
    - new/ class/ extends
    - new / function/ prototype
  - Special
    - Function
      - \[\[call\]\]
    - Array
      - \[\[ length \]\]
    - Object.prototype
      - no more prototype
    - Argument
      ......

7 种语言规范类型

- Reference
- List
- Completion
- Property Description
- Lexical Environment
- Environment Record
- Data Block

#### Event Loop

How the Engine to be used to execute the JS Code
Operator:

1. Get Code
2. Execute
3. Wait
   And get the Code, Execute, Wait .....

#### Execution Context

The Frame in the Execution Stack which contain the following information

1. Code Evaluation State
   - used for store the async/generator function's execution state.
2. Function

3. Script or Module

4. Generator

5. Realm
   - Store all usable internal object, for instance Object.prototype
6. LexicalEnvironment

   - Internal maintained a Identifier-Variable Mapping
     Structure Aka Enrionment Record.
     - Identifier: varname, or fun name
     - Variable: The Reference of Identifier
   - enviroment for store the
     1. thie
     2. new.target
     3. super
     4. let/const defined vars
     5. Outer Environment Reference

7. VariableEnvironment
   - vars

#### Enviroment Records

Enviroment is a subtyping system
Enviroment Records

- Declarative Environment Records
  - Function Environment Records
  - Module Environment Records
- Global Environment Record
- Object Environment Record
